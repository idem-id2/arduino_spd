<UserControl x:Class="HexEditor.HexEdit.HexEditorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:HexEditor.HexEdit"
             mc:Ignorable="d"
             Background="Transparent"
             Focusable="True"
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.ContextMenu>
        <ContextMenu x:Name="EditorContextMenu">
            <MenuItem Header="Copy" Click="ContextMenuCopy_Click" InputGestureText="Ctrl+C"/>
            <MenuItem Header="Paste" Click="ContextMenuPaste_Click" InputGestureText="Ctrl+V"/>
            <Separator/>
            <MenuItem Header="Select All" Click="ContextMenuSelectAll_Click" InputGestureText="Ctrl+A"/>
            <Separator/>
            <MenuItem Header="Fill Selection" x:Name="FillSubMenu">
                <MenuItem Header="Fill with 00" Click="FillWith00_Click"/>
                <MenuItem Header="Fill with FF" Click="FillWithFF_Click"/>
            </MenuItem>
            <Separator/>
            <MenuItem Header="Add Bookmark" x:Name="BookmarkSubMenu">
                <MenuItem Header="Red (Ctrl+1)" Click="AddRedBookmark_Click"/>
                <MenuItem Header="Orange (Ctrl+2)" Click="AddOrangeBookmark_Click"/>
                <MenuItem Header="Yellow (Ctrl+3)" Click="AddYellowBookmark_Click"/>
                <MenuItem Header="Green (Ctrl+4)" Click="AddGreenBookmark_Click"/>
                <MenuItem Header="RoyalBlue (Ctrl+5)" Click="AddBlueBookmark_Click"/>
                <MenuItem Header="Blue (Ctrl+6)" Click="AddDarkBlueBookmark_Click"/>
                <MenuItem Header="Purple (Ctrl+7)" Click="AddMagentaBookmark_Click"/>
                <MenuItem Header="DeepPink (Ctrl+8)" Click="AddCyanBookmark_Click"/>
                <MenuItem Header="Brown (Ctrl+9)" Click="AddBrownBookmark_Click"/>
                <MenuItem Header="Black (Ctrl+0)" Click="AddDarkGrayBookmark_Click"/>
            </MenuItem>
            <MenuItem Header="Add Range Bookmark" x:Name="RangeBookmarkSubMenu">
                <MenuItem Header="Red Frame (Ctrl+Alt+1)" Click="AddRedRangeBookmark_Click"/>
                <MenuItem Header="Orange Frame (Ctrl+Alt+2)" Click="AddOrangeRangeBookmark_Click"/>
                <MenuItem Header="Yellow Frame (Ctrl+Alt+3)" Click="AddYellowRangeBookmark_Click"/>
                <MenuItem Header="Green Frame (Ctrl+Alt+4)" Click="AddGreenRangeBookmark_Click"/>
                <MenuItem Header="RoyalBlue Frame (Ctrl+Alt+5)" Click="AddBlueRangeBookmark_Click"/>
                <MenuItem Header="Blue Frame (Ctrl+Alt+6)" Click="AddDarkBlueRangeBookmark_Click"/>
                <MenuItem Header="Purple Frame (Ctrl+Alt+7)" Click="AddMagentaRangeBookmark_Click"/>
                <MenuItem Header="DeepPink Frame (Ctrl+Alt+8)" Click="AddCyanRangeBookmark_Click"/>
                <MenuItem Header="Brown Frame (Ctrl+Alt+9)" Click="AddBrownRangeBookmark_Click"/>
                <MenuItem Header="Black Frame (Ctrl+Alt+0)" Click="AddDarkGrayRangeBookmark_Click"/>
            </MenuItem>
            <MenuItem Header="Remove Bookmarks" x:Name="RemoveBookmarkSubMenu">
                <MenuItem Header="Remove All Single" Click="RemoveAllBookmarks_Click"/>
                <MenuItem Header="Remove All Range" Click="RemoveAllRangeBookmarks_Click"/>
                <Separator/>
                <MenuItem Header="Remove Red" Click="RemoveRedBookmark_Click"/>
                <MenuItem Header="Remove Orange" Click="RemoveOrangeBookmark_Click"/>
                <MenuItem Header="Remove Yellow" Click="RemoveYellowBookmark_Click"/>
                <MenuItem Header="Remove Green" Click="RemoveGreenBookmark_Click"/>
                <MenuItem Header="Remove RoyalBlue" Click="RemoveBlueBookmark_Click"/>
                <MenuItem Header="Remove Blue" Click="RemoveDarkBlueBookmark_Click"/>
                <MenuItem Header="Remove Purple" Click="RemoveMagentaBookmark_Click"/>
                <MenuItem Header="Remove DeepPink" Click="RemoveCyanBookmark_Click"/>
                <MenuItem Header="Remove Brown" Click="RemoveBrownBookmark_Click"/>
                <MenuItem Header="Remove Black" Click="RemoveDarkGrayBookmark_Click"/>
            </MenuItem>
        </ContextMenu>
    </UserControl.ContextMenu>

    <Grid Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Основная панель отрисовки -->
        <ScrollViewer x:Name="PART_ScrollViewer"
                      Grid.Row="0"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      CanContentScroll="True"
                      Background="Transparent">
            <ScrollViewer.Resources>
                <!-- Ускоренный RepeatButton для плавного скроллинга -->
                <Style x:Key="ScrollBarLineButton" TargetType="{x:Type RepeatButton}">
                    <Setter Property="SnapsToDevicePixels" Value="True"/>
                    <Setter Property="OverridesDefaultStyle" Value="true"/>
                    <Setter Property="Focusable" Value="false"/>
                    <Setter Property="Delay" Value="100"/>
                    <Setter Property="Interval" Value="25"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type RepeatButton}">
                                <Border Name="Border" CornerRadius="2" Background="#F0F0F0" BorderBrush="#C0C0C0" BorderThickness="1">
                                    <Path HorizontalAlignment="Center" VerticalAlignment="Center" Fill="#606060" Data="{Binding Path=Content, RelativeSource={RelativeSource TemplatedParent}}"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="true">
                                        <Setter TargetName="Border" Property="Background" Value="#E0E0E0"/>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="true">
                                        <Setter TargetName="Border" Property="Background" Value="#D0D0D0"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>

                <Style x:Key="ScrollBarPageButton" TargetType="{x:Type RepeatButton}">
                    <Setter Property="SnapsToDevicePixels" Value="True"/>
                    <Setter Property="OverridesDefaultStyle" Value="true"/>
                    <Setter Property="IsTabStop" Value="false"/>
                    <Setter Property="Focusable" Value="false"/>
                    <Setter Property="Delay" Value="100"/>
                    <Setter Property="Interval" Value="25"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type RepeatButton}">
                                <Border Background="Transparent"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>

                <Style TargetType="{x:Type ScrollBar}">
                    <Setter Property="SnapsToDevicePixels" Value="True"/>
                    <Setter Property="OverridesDefaultStyle" Value="true"/>
                    <Style.Triggers>
                        <Trigger Property="Orientation" Value="Vertical">
                            <Setter Property="Width" Value="18"/>
                            <Setter Property="Height" Value="Auto"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="18"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="18"/>
                                            </Grid.RowDefinitions>
                                            <RepeatButton Grid.Row="0" Style="{StaticResource ScrollBarLineButton}" Height="18" Command="ScrollBar.LineUpCommand" Content="M 0 4 L 8 4 L 4 0 Z"/>
                                            <Track Name="PART_Track" Grid.Row="1" IsDirectionReversed="true">
                                                <Track.DecreaseRepeatButton>
                                                    <RepeatButton Style="{StaticResource ScrollBarPageButton}" Command="ScrollBar.PageUpCommand"/>
                                                </Track.DecreaseRepeatButton>
                                                <Track.Thumb>
                                                    <Thumb Style="{DynamicResource ScrollBarThumb}"/>
                                                </Track.Thumb>
                                                <Track.IncreaseRepeatButton>
                                                    <RepeatButton Style="{StaticResource ScrollBarPageButton}" Command="ScrollBar.PageDownCommand"/>
                                                </Track.IncreaseRepeatButton>
                                            </Track>
                                            <RepeatButton Grid.Row="2" Style="{StaticResource ScrollBarLineButton}" Height="18" Command="ScrollBar.LineDownCommand" Content="M 0 0 L 4 4 L 8 0 Z"/>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Trigger>
                    </Style.Triggers>
                </Style>

                <Style x:Key="ScrollBarThumb" TargetType="{x:Type Thumb}">
                    <Setter Property="SnapsToDevicePixels" Value="True"/>
                    <Setter Property="OverridesDefaultStyle" Value="true"/>
                    <Setter Property="IsTabStop" Value="false"/>
                    <Setter Property="Focusable" Value="false"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type Thumb}">
                                <Border CornerRadius="2" Background="#C0C0C0" BorderBrush="#A0A0A0" BorderThickness="1"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ScrollViewer.Resources>
            <local:HexEditorPanel x:Name="PART_HexPanel"
                                  Background="Transparent"/>
        </ScrollViewer>

        <!-- Статусбар -->
        <Border x:Name="StatusBarHost"
                Grid.Row="1" 
                Background="white" 
                BorderBrush="#C0C0C0"
                BorderThickness="0,1,0,0">
            <StackPanel Orientation="Vertical">
                <TextBlock x:Name="AddressStatusText" 
                          FontSize="13"
                          FontWeight="Normal"
                          Foreground="#333333"
                          ContextMenuOpening="AddressStatusText_ContextMenuOpening"
                          Padding="8,4,8,2"
                          TextWrapping="Wrap">
                    <TextBlock.ContextMenu>
                        <ContextMenu x:Name="StatusContextMenu">
                            <MenuItem Header="Copy Full Status" Click="CopyFullStatus_Click"/>
                            <Separator/>
                            <MenuItem Header="Copy HEX Offset" Click="CopyHexOffset_Click"/>
                            <MenuItem Header="Copy DEC Offset" Click="CopyDecOffset_Click"/>
                            <MenuItem Header="Copy Current Byte" Click="CopyCurrentByte_Click"/>
                            <MenuItem Header="Copy Selection Info" Click="CopySelectionInfo_Click"/>
                            <Separator/>
                            <MenuItem Header="Copy Modified Bytes Count" Click="CopyModifiedCount_Click"/>
                            <MenuItem Header="Copy Bookmarks Info" Click="CopyBookmarksInfo_Click"/>
                        </ContextMenu>
                    </TextBlock.ContextMenu>
                </TextBlock>

                <Border BorderBrush="#E0E0E0"
                        BorderThickness="0,1,0,0"
                        Margin="8,0,8,0"/>

                <StackPanel Orientation="Horizontal"
                            Margin="8,2,8,4"
                            VerticalAlignment="Center">
                    <TextBlock x:Name="WarningStatusText"
                               FontSize="11"
                               Foreground="#CC5A00"
                               Text="Предупреждений нет"/>
                    <TextBlock x:Name="ModifiedStatusText"
                               FontSize="11"
                               Foreground="#444444"
                               Margin="16,0,0,0"
                               Text="Изменено: 0"/>
                    <TextBlock x:Name="EditorBookmarkStatusText"
                               FontSize="11"
                               Foreground="#444444"
                               Margin="16,0,0,0"
                               Text="Закладки: 0 / 0"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>